{% extends "base.html" %}
{% block title %}Tools Dashboard - Family Wiki Tools{% endblock %}

{% block content %}
<div class="tools-dashboard">
    <div class="page-header">
        <h2>Tools Dashboard</h2>
        <p>Submit jobs and track their progress</p>
    </div>

    <!-- Job Input Forms -->
    <div class="job-forms">
        <div class="form-section">
            <h3>OCR Processing</h3>
            <form method="POST" action="{{ url_for('tools.start_ocr') }}" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="pdf_files">PDF Files:</label>
                    <input type="file" id="pdf_files" name="pdf_files" multiple accept=".pdf">
                    <small>Select PDF files to process, or leave blank to use default folder. For proper ordering, name files like: 001.pdf, 002.pdf, 003.pdf, etc.</small>
                </div>
                <button type="submit" class="btn btn-primary">Start OCR Job</button>
            </form>
        </div>

        <div class="form-section">
            <h3>Genealogy Extraction</h3>
            <form method="POST" action="{{ url_for('tools.start_extraction') }}" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="text_file">Text File (optional):</label>
                    <input type="file" id="text_file" name="text_file" accept=".txt">
                    <small>Upload a text file to extract from, or leave blank to use latest OCR results</small>
                </div>
                <button type="submit" class="btn btn-primary">Start Extraction Job</button>
            </form>
        </div>

        <div class="form-section">
            <h3>GEDCOM Generation</h3>
            <form method="POST" action="{{ url_for('tools.start_gedcom') }}" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="gedcom_input_file">Input JSON File (optional):</label>
                    <input type="file" id="gedcom_input_file" name="input_file" accept=".json">
                    <small>Upload extraction results JSON file, or leave blank to use latest extraction results</small>
                </div>
                <button type="submit" class="btn btn-primary">Start GEDCOM Job</button>
            </form>
        </div>

        <div class="form-section">
            <h3>Research Questions</h3>
            <form method="POST" action="{{ url_for('tools.start_research') }}" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="research_input_file">Input JSON File (optional):</label>
                    <input type="file" id="research_input_file" name="input_file" accept=".json">
                    <small>Upload extraction results JSON file, or leave blank to use latest extraction results</small>
                </div>
                <button type="submit" class="btn btn-primary">Start Research Job</button>
            </form>
        </div>
    </div>

    <!-- Jobs Table -->
    <div class="jobs-section">
        <h3>Job Status</h3>
        <p><a href="{{ url_for('tools.dashboard') }}" class="btn btn-secondary">Refresh</a></p>
        
        <table class="jobs-table">
            <thead>
                <tr>
                    <th>Task ID</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Progress</th>
                    <th>Started</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for job in jobs %}
                <tr>
                    <td><code>{{ job.task_id }}</code></td>
                    <td>{{ job.type }}</td>
                    <td>{{ job.status }}</td>
                    <td>{{ job.progress }}%</td>
                    <td>{{ job.started or 'N/A' }}</td>
                    <td>
                        {% if job.status in ['RUNNING', 'PENDING'] %}
                        <form method="POST" action="{{ url_for('tools.cancel_job', task_id=job.task_id) }}" style="display: inline;">
                            <button type="submit" class="btn btn-danger" 
                                    onclick="return confirm('Cancel this job?')">Cancel</button>
                        </form>
                        {% endif %}
                        
                        {% if job.status == 'SUCCESS' and job.download_available %}
                        <a href="{{ url_for('tools.download_result', task_id=job.task_id) }}" class="btn btn-success">Download</a>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6">No jobs found</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}