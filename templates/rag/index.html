{% extends "base.html" %}

{% block title %}RAG Query Interface{% endblock %}

{% block content %}
<div class="container">
    <h1>RAG Query Interface</h1>
    
    <!-- Query Form Section -->
    {% if active_corpus %}
    <div class="query-section">
        <h3>Ask a Question</h3>
        <form id="rag-query-form" method="POST" action="{{ url_for('rag.submit_query') }}">
            <div class="form-group">
                <label for="question">Question:</label>
                <textarea id="question" name="question" class="form-control" rows="3" 
                         placeholder="Ask a question about the source documents..." required></textarea>
                <small class="form-help">Ask questions about people, places, events, or relationships mentioned in the source texts.</small>
            </div>
            
            <div class="form-group">
                <label for="session_name">Session Name (optional):</label>
                <input type="text" id="session_name" name="session_name" class="form-control" 
                       placeholder="e.g., Research Session 1">
                <small class="form-help">Group related questions together in a named session.</small>
            </div>
            
            <button type="submit" class="btn btn-primary">Submit Query</button>
        </form>
    </div>
    {% endif %}

    <div class="row">
        <div class="col-md-6">
            <h3>Available Corpora</h3>
            {% if corpora %}
                <ul class="list-group">
                    {% for corpus in corpora %}
                        <li class="list-group-item">
                            {{ corpus.name }}
                            {% if active_corpus and corpus.id == active_corpus.id %}
                                <span class="badge badge-primary">Active</span>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No corpora available.</p>
            {% endif %}
            
            <div class="mt-3">
                <a href="{{ url_for('rag.corpora_list') }}" class="btn btn-secondary">Manage Corpora</a>
            </div>
        </div>
        
        <div class="col-md-6">
            {% if active_corpus %}
                <h3>Active Corpus: {{ active_corpus.name }}</h3>
                {% if corpus_stats %}
                    <ul class="list-unstyled">
                        <li><strong>Total Chunks:</strong> {{ corpus_stats.total_chunks }}</li>
                        <li><strong>Total Sources:</strong> {{ corpus_stats.total_sources }}</li>
                        <li><strong>Avg Chunk Length:</strong> {{ corpus_stats.avg_chunk_length }}</li>
                    </ul>
                {% endif %}
            {% else %}
                <div class="alert alert-warning">
                    <strong>No Active Corpus</strong><br>
                    You need to have an active corpus to ask questions. Please check the corpus management page.
                </div>
            {% endif %}
            
            <div class="mt-3">
                <a href="{{ url_for('rag.sessions_list') }}" class="btn btn-secondary">View Query Sessions</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}